name: CMake Build

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. Checkout the code AND its submodules
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        submodules: recursive

    # 2. Install Linux System Dependencies (GLFW, OpenGL, X11)
    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libgl1-mesa-dev libxrandr-dev libxinerama-dev \
        libxcursor-dev libxi-dev xorg-dev libglfw3-dev libglm-dev build-essential cmake

    # 3. Configure CMake
    - name: Configure CMake
      run: cmake -S . -B build -DCMAKE_BUILD_TYPE=Release

    # 4. Build with CMake
    - name: Build
      run: cmake --build build --config Release

    # 5. Verify the file was created
    - name: Verify Build
      run: ls -l build/gooseVoxelEngine