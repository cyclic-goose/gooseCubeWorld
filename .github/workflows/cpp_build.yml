name: C++ Build (g++)

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    # 1. Checkout the code
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. Install Linux System Dependencies (GLFW, OpenGL, X11)
    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libgl1-mesa-dev libxrandr-dev libxinerama-dev libxcursor-dev libxi-dev xorg-dev libglfw3-dev

    # 3. Create Build Directories (Just like your setup task)
    - name: Prepare Directories
      run: mkdir -p build/release

    # 4. Compile with g++ (Matches your "Release" task)
    - name: Build with g++
      run: |
        g++ \
        -O3 -DNDEBUG -s -static-libgcc -static-libstdc++ -std=c++17 \
        src/*.cpp \
        src/vendor/glad.c \
        src/vendor/imgui/*.cpp \
        src/vendor/imgui/backends/imgui_impl_glfw.cpp \
        src/vendor/imgui/backends/imgui_impl_opengl3.cpp \
        -Isrc/vendor/imgui \
        -Isrc/vendor/imgui/backends \
        -I/usr/include \
        -Iinclude \
        -o build/release/gooseVoxelEngine \
        -lglfw -lGL -ldl -lpthread -lX11

    # 5. Verify the file was created
    - name: Verify Build
      run: ls -l build/release/gooseVoxelEngine